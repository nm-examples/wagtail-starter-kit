services:
  db:
    # MYSQL - un-comment to use -----------------------------------------
    image: mysql:8.0.29
      # this is required becuse of
      # django.db.utils.OperationalError: (2061, 'RSA Encryption not supported - caching_sha2_password plugin was built with GnuTLS support')
    command: --default-authentication-plugin=mysql_native_password
    ports:
      - "3306:3306"
    volumes:
      - dbdata:/var/lib/mysql
    healthcheck:
      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost" ]
      interval: 10s
      timeout: 20s
      retries: 5
    # END MYSQL ---------------------------------------------------------

    # POSTGRES - un-comment to use --------------------------------------
    # image: postgres:16
    # ports:
    #   - "5432:5432"
    # volumes:
    #   - dbdata:/var/lib/postgresql/data
    # healthcheck:
    #   test: [ "CMD-SHELL", "pg_isready -U postgres" ]
    #   interval: 10s
    #   timeout: 20s
    #   retries: 5
    # END POSTGRES ------------------------------------------------------

  # A convienient utility app to manage the database https://hub.docker.com/_/adminer/
  # Adminer is a full-featured database management tool written in PHP.
  # It can be used to manage MySQL, PostgreSQL, SQLite, MS SQL, Oracle, SimpleDB, Elasticsearch, and MongoDB databases.
  # Accessible at http://localhost:8080
  adminer:
    image: adminer
    ports:
      - 8080:8080
    depends_on:
      db:
        condition: service_healthy

  # A convienient utility app to test 'real' emails https://hub.docker.com/r/mailhog/mailhog/
  # MailHog is an email testing tool for developers.
  # It catches all emails sent by your application and allows you to preview them in a web interface.
  # Accessible at http://localhost:8025
  mailhog:
    image: mailhog/mailhog
    platform: linux/amd64
    logging:
      driver: 'none'  # disable saving logs
    ports:
      - 1025:1025 # smtp server
      - 8025:8025 # web ui
